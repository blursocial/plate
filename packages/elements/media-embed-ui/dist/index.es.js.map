{"version":3,"file":"index.es.js","sources":["../src/MediaEmbedElement/MediaEmbedElement.styles.ts","../src/MediaEmbedElement/MediaEmbedUrlInput.tsx","../src/MediaEmbedElement/MediaEmbedElement.tsx","../src/ToolbarMediaEmbed/ToolbarMediaEmbed.tsx"],"sourcesContent":["import { createStyles } from '@udecode/plate-styled-components';\nimport { css } from 'styled-components';\nimport tw from 'twin.macro';\nimport { MediaEmbedElementProps } from './MediaEmbedElement.types';\n\nexport const getMediaEmbedElementStyles = (props: MediaEmbedElementProps) =>\n  createStyles(\n    { prefixClassNames: 'MediaEmbedElement', ...props },\n    {\n      root: tw`relative`,\n      iframeWrapper: [tw`relative`, tw`padding[75% 0 0 0]`],\n      iframe: [tw`absolute top-0 left-0 w-full h-full`],\n      input: [\n        tw`w-full`,\n        css`\n          padding: 0.5em;\n          font-size: 0.85em;\n          border: 2px solid #ddd;\n          background: #fafafa;\n          margin-top: 5px;\n        `,\n      ],\n    }\n  );\n","import React from 'react';\nimport { CSSProp } from 'styled-components';\n\nexport const MediaEmbedUrlInput = ({\n  url,\n  onChange,\n  ...props\n}: {\n  className?: string;\n  css?: CSSProp;\n  url: string;\n  onChange: Function;\n}) => {\n  const [value, setValue] = React.useState(url);\n\n  const validateUrl = (newUrl: string) => {\n    // if not starting with http, assume pasting of full iframe embed code\n    if (newUrl.substring(0, 4) !== 'http') {\n      const regexMatchSrc = /src=\".*?\"/;\n      const regexGroupQuotes = /\"([^\"]*)\"/;\n\n      const src = newUrl.match(regexMatchSrc)?.[0];\n      const returnString = src?.match(regexGroupQuotes)?.[1];\n\n      if (returnString) {\n        newUrl = returnString;\n      }\n    }\n    return newUrl;\n  };\n\n  return (\n    <input\n      value={value}\n      onClick={(e) => e.stopPropagation()}\n      onChange={(e) => {\n        const newUrl = e.target.value;\n        validateUrl(newUrl);\n        setValue(newUrl);\n        onChange(newUrl);\n      }}\n      {...props}\n    />\n  );\n};\n","import React from 'react';\nimport { setNodes } from '@udecode/plate-common';\nimport { TElement, useEditorRef } from '@udecode/plate-core';\nimport { MediaEmbedNodeData } from '@udecode/plate-media-embed';\nimport { ReactEditor } from 'slate-react';\nimport { getMediaEmbedElementStyles } from './MediaEmbedElement.styles';\nimport { MediaEmbedElementProps } from './MediaEmbedElement.types';\nimport { MediaEmbedUrlInput } from './MediaEmbedUrlInput';\n\nexport const MediaEmbedElement = (props: MediaEmbedElementProps) => {\n  const {\n    attributes,\n    children,\n    nodeProps,\n    styles: _styles,\n    element,\n    classNames,\n    prefixClassNames,\n    ...rootProps\n  } = props;\n\n  const editor = useEditorRef();\n  const { url } = element;\n  const querySeparator = url.includes('?') ? '' : '?';\n\n  const styles = getMediaEmbedElementStyles(props);\n\n  return (\n    <div\n      {...attributes}\n      css={styles.root.css}\n      className={styles.root.className}\n      {...rootProps}\n    >\n      <div contentEditable={false}>\n        <div\n          css={styles.iframeWrapper?.css}\n          className={styles.iframeWrapper?.className}\n        >\n          <iframe\n            css={styles.iframe?.css}\n            className={styles.iframe?.className}\n            title=\"embed\"\n            src={`${url}${querySeparator}&title=0&byline=0&portrait=0`}\n            frameBorder=\"0\"\n            {...nodeProps}\n          />\n        </div>\n\n        <MediaEmbedUrlInput\n          data-testid=\"MediaEmbedUrlInput\"\n          css={styles.input?.css}\n          className={styles.input?.className}\n          url={url}\n          onChange={(val: string) => {\n            const path = ReactEditor.findPath(editor, element);\n            setNodes<TElement<MediaEmbedNodeData>>(\n              editor,\n              { url: val },\n              { at: path }\n            );\n          }}\n        />\n      </div>\n      {children}\n    </div>\n  );\n};\n","import React from 'react';\nimport { useEventEditorId, useStoreEditorRef } from '@udecode/plate-core';\nimport { insertMediaEmbed } from '@udecode/plate-media-embed';\nimport { ToolbarButton, ToolbarButtonProps } from '@udecode/plate-toolbar';\n\nexport interface ToolbarMediaEmbedProps extends ToolbarButtonProps {\n  /**\n   * Default onMouseDown is getting the embed url by calling this promise before inserting the embed.\n   */\n  getEmbedUrl?: () => Promise<string>;\n}\n\nexport const ToolbarMediaEmbed = ({\n  getEmbedUrl,\n  ...props\n}: ToolbarMediaEmbedProps) => {\n  const editor = useStoreEditorRef(useEventEditorId('focus'));\n\n  return (\n    <ToolbarButton\n      onMouseDown={async (event) => {\n        if (!editor) return;\n\n        event.preventDefault();\n\n        let url;\n        if (getEmbedUrl) {\n          url = await getEmbedUrl();\n        } else {\n          url = window.prompt('Enter the URL of the embed:');\n        }\n        if (!url) return;\n\n        insertMediaEmbed(editor, { url });\n      }}\n      {...props}\n    />\n  );\n};\n"],"names":["getMediaEmbedElementStyles","props","createStyles","prefixClassNames","root","iframeWrapper","iframe","input","css","MediaEmbedUrlInput","url","onChange","value","setValue","React","useState","validateUrl","newUrl","substring","regexMatchSrc","regexGroupQuotes","src","match","returnString","e","stopPropagation","target","MediaEmbedElement","attributes","children","nodeProps","styles","_styles","element","classNames","rootProps","editor","useEditorRef","querySeparator","includes","className","val","path","ReactEditor","findPath","setNodes","at","ToolbarMediaEmbed","getEmbedUrl","useStoreEditorRef","useEventEditorId","event","preventDefault","window","prompt","insertMediaEmbed"],"mappings":"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"}